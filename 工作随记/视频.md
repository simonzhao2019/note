### 一、流媒体传输协议

#### 1、Hls（HTTP Live Streaming）流媒体传输协议

在http基础之上的流媒体传输协议，是苹果公司在http基础之上退出的流媒体传输协议，主要是用来进行直播。

HTTP 视频协议是在互联网普及之后在互联网上看视频的需求下形成的。最初的 HTTP 视频协议，没有任何特别之处，就是通用的 HTTP 文件渐进式下载，但是在这种情况下，视频无法快进或者跳转到文件尚未被下载到的部分，这就对 HTTP 协议提出了范围请求（Range Request）的要求，目前几乎所有 HTTP 服务器都支持范围请求。所谓范围请求指的是请求文件的部分数据，这可以在 HTTP 请求头中通过 Range 字段设置偏移量来实现。

这种方式应用于视频点播还可以，用于直播的话实时性较差，延迟也很高，于是，苹果公司又在 HTTP 协议的基础上推出了 HTTP Live Streaming（简称 HLS）这个流媒体传输协议，主要用于在 iOS 系统中实现流媒体的直播和点播。

相对于常见的流媒体直播协议，HLS 直播最大的不同在于，直播客户端获取到的并不是一个完整的数据流，HLS协议在服务器端将直播数据流存储为连续的、很短时长的媒体文件（MPEG-TS格式），而客户端则不断下载并播放这些小文件。因为服务器总是会将最新的直播数据生成新的小文件，这样客户端只要不停地按顺序播放从服务器获取到的文件，就实现了直播。

由此可见，HLS 是以点播的技术实现直播。由于数据通过 HTTP 协议传输，所以完全不用考虑防火墙或者代理的问题，而且分段文件的时长很短，客户端可以很快的选择和切换码率，以适应不同带宽条件下的播放。不过HLS 的这种技术特点，决定了它的延迟一般总是会高于普通的流媒体直播协议。



#### 2、**RTP 与 RTCP**

RTP（Real-time Transport Protocol，实时传输协议）是互联网上针对多媒体数据流的一种实时传输协议。RTP 由紧密连接的两个部分组成：

- RTP 协议：传送具有实时属性的数据；
- RTP 控制协议（简称 RTCP）：监控服务质量并传送正在进行的会话参与者的相关信息。

RTP 协议详细说明了在互联网上传输音频和视频的标准数据包格式，常用于流媒体系统（配合 RTSP 协议，下面会介绍这个协议）、视频会议和视频电话系统（配合 H.263 或 SIP）。

RTP 协议是建立在 UDP 协议之上的，因此本身并没有提供按时发送机制或其他服务质量（QoS）保证，它依赖于底层服务去实现这一过程。RTCP 协议则是 RTP 协议的一个姐妹协议，它会定期在流媒体会话参加者之间传输控制数据，用来为 RTP 所提供的服务质量提供反馈。RTCP 协议会收集相关媒体连接的统计信息，如传输字节数、传输分组数、丢失分组数、时延抖动、单向和双向网络延迟等等，网络应用程序可以利用 RTCP 所提供的信息提高服务质量，比如限制信息流量或改用压缩比较小的编解码器。RTCP 协议本身不提供数据加密或身份认证，其伴生协议 SRTCP（安全的实时传输控制协议）则可用于此类用途。

#### 3、RTSP

RTSP（Real Time Streaming Protocol，实时流协议）协议是最早的视频传输协议，定义了一对多应用程序如何有效通过 IP 网络传输多媒体数据。RTSP 在体系结构上位于 RTP 和 RTCP 之上，是一种双向实时数据传输协议，它允许客户端向服务器端发送请求，如回放、快进、倒退等操作。RTSP 可基于 RTP 来传送数据，还可以选择 TCP、UDP、组播 UDP 等通道来发送数据，具有很好的扩展性。

RTSP 协议的优势在于可以控制到视频帧，因此可以承载实时性很高的应用，这个优点也是相对于 HTTP 传输方式的最大优点。不过 iOS 系统不支持该协议，Andriod 系统原生支持。

#### 4、RSVP 

RSVP 即资源预订协议，使用 RSVP 预留一部分网络资源（即带宽），能在一定程度上为流媒体的传输提供QoS。RSVP、RTSP 与 RTP 协议工作在不同的层次，如下图所示

#### 5、**RTMP**

RTMP（Real Time Messaging Protocol，实时消息传输协议）是 Adobe 公司为 Flash 播放器和服务器之间音频、视频和数据传输开发的流媒体协议。它有以下三种变种：

- 工作在 TCP 之上的明文协议，使用端口 1935；
- RTMPT 封装在 HTTP 请求之中，可穿越防火墙；
- RTMPS 类似 RTMPT，但使用的是 HTTPS 连接。

RTMP 协议采用实时的流式传输，所以不会缓存文件到客户端，因此用户想下载 RTMP 协议下的视频是比较难的，该协议下的视频流可以随便拖动，可以从任意时间点向服务器发送请求进行播放，并不需要视频有关键帧。相比之下，HTTP 协议下视频需要有关键帧才可以拖动。RTMP 协议可以支持点播、回放和直播。

因为该协议是 Adobe 公司开发的，所以最初服务器端架设的环境是 FMS（Flash Media

Server)，该软件为收费软件，价格昂贵。后来，开源软件 red5 的推出使支持 RTMP 协议的服务器架设成本大大缩小，但是在性能方面不如 FMS 稳定。

#### 6、MMS

MMS（Microsoft Media Server Protocol，微软媒体服务协议）是用来访问并流式接收 Windows 媒体服务器中 `.asf` 文件的一种协议。MMS 协议用于访问 Windows Media 发布点上的单播内容，是连接Windows Media 单播服务的默认方法。如果用户在 Windows Media Player 中键入一个 URL 以连接内容，而不是通过超链接，则必须使用 MMS 协议引用该流。

### 二、视频编码

#### 1、视频编码标准制定

1.）国际电信联盟电信标准化部门（简称 ITU-T）旗下的 **VCEG**（Video Coding Experts Group，视频编码专家组），因为是电信联盟，所以他们最初做视频编码主要侧重传输，这个编码组制定的视频通信协议包括 H.261、 H.262、H.263、H.264、H.265 等；

2.）国际标准组织（简称 ISO）旗下的 **MPEG**（Moving Picture Experts Group，动态图像专家组），他们本来是做视频存储的，例如将编码后的视频保存在 VCD 和 DVD 中，随着 VCD 和 DVD 的消逝，后来也慢慢侧重视频传输了，这个编码组制定了的视频编码标准包括 MPEG-1、MPEG-2、MPEG-4、MPEG-7 等。

**注：**视频编码与视频格式

视频编码是一种压缩技术，就是把原始的视频流压缩成特定的比特流（视编码方案）。视频格式是一种封装格式，就是把编码后的比特流进行封装，不同的视频格式封装方法不同。打个比方，原始的模拟视频采用MPEG2数字化编码后，你可以采用TS流格式封装成TS流文件，也可以采用PS流格式封装成PS流文件，选择权在于你，TS流是称为实时流，他把视频信息分成很多很小的包，损坏了一个包，你解码回放时只是看不见一小部分（例如出现马赛克），但是PS流是文件流，文件损害的话，整个文件都看不了了。再形象的说，一段视频资源用TS流封装就是把这段视频切成10个部分，放到10个盒子里，一个盒子一个盒子的按照顺序打开，你就能看完这段视频；而PS流式把整个视频放到1个盒子里，它会自动按照顺序播放出来给您观看；如果有一个盒子坏了，TS流可以看到9个盒子，PS你就都看不见了。

```js
封装格式：编码格式
AVI：MPEG-2，DIVX，XVID，AC-1，H.264;
WMV：WMV，AC-1;
RM、RMVB：RV， RM;
MOV：MPEG-2，XVID，H.264;
TS/PS：MPEG-2，H.264，MPEG-4;
MKV：可以封装所有的视频编码格式。
```

#### 2、常用视频编码

##### 1.）　H.264

　　H.264标准由联合视频团队（JVT：JointVideoTeam）制定，该团队包括ITU-T（InternationalTelemcommunicationUnion-TelecommunicationStandardizationsector，国际电信联盟-电信标准部门）的VCEG（VideoCodingExpertsGroup，视频编码专家组），和ISO/IEC的MPEG（MovingPictureExpertsGroup，运动图像专家组）组成。由于H.264便于一种网络友好的视频表示，它能支持各种互动的（视频电话）和非互动的应用（广播、流媒体、存储、视频点播）。它再次使用了以前编码标准的思想，诸如MPEG-1、MPEG-2、MPEG-4第2部分、H.261、H.262和H.263，并增加了许多其他的编码工具和方法，从而使得它具有优越的质量和压缩效率。像任何其他以前的基于运动的编解码系统一样，它使用了下列基本的视频压缩原则：

　　•用于降低空间相关的变换；

　　•控制比特率的量化；

　　•降低时间相关的运动补偿预测；

　　•降低统计相关的熵编码。

　　H.264改善的编码效率可以归因于附加的编码工具和新的特征。H.264首次使

　　用的部分新的和改进的方法罗列如下：

　　•自适应帧内预测；

　　•整数精度的小尺寸块变换；

　　•多参考帧和广义的B帧；

　　•可变的块大小；

　　•1/4像素精度的运动补偿；

　　•内容自适应环路去块效应滤波器；

　　•引入CABAC（上下文自适应二进制算术编码）和CAVLC（上下文自适应变长编码）改善的熵编码。

　　与以往的编码标准相比，编码效率的提高以及压缩比的提高导致了H·264编码器和解码器算法较大的复杂度。为了便于在网络上传输信息而进行抗误码设计，H.264支持以下技术：

　　•灵活的宏块排序；

　　•切换分片；

　　•任意的分片顺序；

　　•冗余分片；

　　•数据分割；

　　•参数设置。

### 三、几个容易混淆的概念

1、容器格式

像 MP3、MP4、WebM这些术语叫做[容器格式](https://developer.mozilla.org/zh-CN/docs/Web/Media/Formats/Containers)。他们定义了构成媒体文件的音频轨道和视频轨道的储存结构，其中还包含描述这个媒体文件的元数据，以及用于编码的编码译码器等等。

一个媒体文件的扩展名和MIME类型，与它的容器格式以及它的编码方式没有特定的关系。例如MP3的扩展名是`.mp3`，MIME类型是`audio/mp3`，但是它的容器格式是MPEG-1，编码方式是MPEG-1 Audio Layer III。